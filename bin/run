#!/usr/bin/env bash
# Docker Compose Run Script

# Load environment
# shellcheck disable=1090
. "$(cd "$(dirname "${BASH_SOURCE[0]}")/../" && pwd -P)/envrc"

# Default arguments
update=false
data=false

# Process arguments
while :
do
  case "${1:-}" in
    -u | --update)
      update=true
      shift
      ;;
    -d | --data)
      data=true
      shift
      ;;
    --) # End of all options
      shift
      break
      ;;
    -*)
      e_abort "Error: Unknown option: ${1}"; return 1
      ;;
    *)  # No more options
      break
      ;;
  esac
done

# Set working directory
cd "${APPDIR}" || exit

# Update repo and images if necessary
if [[ "$update" == true ]]; then
  update_repo
  docker_compose_update_images
fi

# Only update data containers
if [[ "$data" == true ]]; then
  docker_compose_start_only data r10k
else
  docker_compose_start
fi
