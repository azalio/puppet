#!/usr/bin/env sh
# Load environment before running the centralized log agent
# Only load credentials from .env (envrc is not SH safe)

# Wait for private data to be deployed
until [ -s /var/local/privatedata_deployed ]; do
  >&2 echo "Private data did not deploy - sleeping"; sleep 5
done

# Load only the private logging.env
# shellcheck disable=1090
. "/etc/puppetlabs/private/${ENVTYPE}/logging.env"

echo "Starting Log Agent"
/bin/logspout "syslog://${LOG_SERVER_ADDRESS}:${LOG_SERVER_PORT}"
