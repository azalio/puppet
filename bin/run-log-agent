#!/usr/bin/env sh
# Load environment before running the centralized log agent
# Only load credentials from .env (envrc is not SH safe)

# Wait for private data to be deployed
until [ -s /var/local/privatedata_deployed ]; do
  >&2 echo "Private data did not deploy - sleeping"; sleep 5
done

# Load only the private .env (envrc has multiple bash only expressions)
# shellcheck disable=1090
. "$(cd "$(dirname "$0")/../" && pwd -P)/.private/.env"

echo "Starting Log Agent"
/bin/logspout "syslog://${LOG_SERVER_ADDRESS}:${LOG_SERVER_PORT}"
