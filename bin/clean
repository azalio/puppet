#!/usr/bin/env bash
# Clean-up tasks

# Load environment
# shellcheck disable=1090
. "$(cd "$(dirname "${BASH_SOURCE[0]}")/../" && pwd -P)/env.sh"

# How many archives to keep
export KEEP=10

# Process arguments
case "${1:-}" in
  all)
    bash -c "${APPDIR}/bin/ami purge"
    aws_s3_purge_deployments
    ;;
  ami)
    bash -c "${APPDIR}/bin/ami purge"
    ;;
  deployments)
    aws_s3_purge_deployments
    ;;
  *)
    e_abort "USAGE: ${BASH_SOURCE[0]} [all | ami | deployments]"
    ;;
esac
