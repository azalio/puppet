{
  "Description": "VGH Puppet CI Access v0.0.1",

  "Resources": {
    "User": {
      "Type": "AWS::IAM::User",
      "Properties": {
        "ManagedPolicyArns": [
          "arn:aws:iam::aws:policy/AmazonSSMFullAccess",
          "arn:aws:iam::aws:policy/AmazonEC2ReadOnlyAccess",
          "arn:aws:iam::aws:policy/AWSLambdaFullAccess"
        ],
        "Policies": [
          {
            "PolicyName": "CIPolicies",
            "PolicyDocument": {
              "Version": "2012-10-17",
              "Statement": [
                {
                  "Sid": "AllowPassRole",
                  "Effect":"Allow",
                  "Action":"iam:PassRole",
                  "Resource":{"Fn::GetAtt": ["CodeDeployRole", "Arn"]}
                },
                {
                  "Sid": "AllowAccessToCodeDeploy",
                  "Effect": "Allow",
                  "Action": ["codedeploy:*"],
                  "Resource": "arn:aws:codedeploy:*"
                },
                {
                  "Sid": "AllowS3Access",
                  "Effect": "Allow",
                  "Action": "*",
                  "Resource": ["arn:aws:s3:::*"]
                },
                {
                  "Sid": "AllowCloudFormationValidate",
                  "Action": [
                    "cloudformation:Describe*",
                    "cloudformation:ValidateTemplate"
                  ],
                  "Effect": "Allow",
                  "Resource": "*"
                }
              ]
            }
          }
        ]
      }
    },
    "AccessKey": {
      "Type": "AWS::IAM::AccessKey",
      "Properties": {
        "UserName": {"Ref": "User"}
      }
    }
  },

  "Outputs": {
    "AccessKey": {
      "Description": "The Access Key",
      "Value": {"Ref": "AccessKey" }
    },
    "SecretKey": {
      "Description": "The Secret Key",
      "Value": {"Fn::GetAtt": [ "AccessKey", "SecretAccessKey" ]}
    }
  }
}
